const Query = require('../../source/query')
const query = require('../../index').query

describe('#()', () => {
  it('should return an instance of query', () => {
    expect(query()).toBeInstanceOf(Query)
  })

  it('should store whatever query is passed to it, defaulting to an empty string', () => {
    expect(query('').query).toBe('')
    expect(query('FOO BAR').query).toBe('FOO BAR')
  })
})

describe('#run()', () => {
  it('should call pg query with the stored query', () => {
    const mockDb = {
      query: jest.fn().mockImplementation(queryString => new Promise((resolve, reject) => {}))
    }
    const testQuery = query('testing')
    testQuery.db = mockDb
    testQuery.run()
    expect(mockDb.query).toHaveBeenCalledWith('testing')
  })
})
